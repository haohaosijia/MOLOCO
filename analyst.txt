First I transfer the date format of the origin excel and save as a new csv file.
Then import the csv file to MySql By code:

create database moloco;
use moloco;
CREATE TABLE SAMPLE
(
TS DATETIME,
USER_ID VARCHAR(10),
COUNTRY_ID VARCHAR(10),
SITE_ID VARCHAR(10)
);
LOAD DATA LOCAL INFILE "D:/job/ds/moloco/sample.txt" INTO TABLE moloco.sample
FIELDS TERMINATED BY ','
LINES TERMINATED BY '\n'
(TS, USER_ID, COUNTRY_ID, SITE_ID);

First question:

SELECT DISTINCT SITE_ID, COUNT(DISTINCT USER_ID) AS USER_ID_COUNT FROM SAMPLE 
WHERE COUNTRY_ID = "BDV" 
GROUP BY SITE_ID ORDER BY USER_ID_COUNT DESC LIMIT 1

Second question:

SELECT USER_ID, SITE_ID, COUNT(USER_ID) as USER_COUNT from SAMPLE
where TS > str_to_date('2019-02-03 00:00:00', '%Y-%m-%d %H:%i:%s') AND TS < str_to_date('2019-02-04 23:59:59', '%Y-%m-%d %H:%i:%s')
group by USER_ID, SITE_ID HAVING USER_COUNT > 10;

Third Question:

SELECT SITE_ID, COUNT(DISTINCT USER_ID) AS USER_COUNT
FROM
(SELECT S.SITE_ID, S.USER_ID
FROM SAMPLE AS S
INNER JOIN 
(SELECT MAX(TS) AS NEWTS, USER_ID FROM SAMPLE GROUP BY USER_ID ORDER BY USER_ID) AS A
ON S.USER_ID=A.USER_ID AND S.ts=A.NEWTS) AS P
GROUP BY SITE_ID
ORDER BY USER_COUNT DESC
LIMIT 5

Forth Question:


SELECT COUNT(DISTINCT USER_ID) FROM
(SELECT LAST.USER_ID, LAST.SITE_ID AS SITE_ID1, FIRST.SITE_ID AS SITE_ID2 FROM
(SELECT L.USER_ID, S.SITE_ID FROM 
(SELECT USER_ID, MAX(TS) AS MAXTS FROM SAMPLE GROUP BY USER_ID) AS L
LEFT JOIN SAMPLE AS S
ON L.USER_ID = S.USER_ID AND L.MAXTS = S.TS) AS LAST
LEFT JOIN
(SELECT F.USER_ID, S.SITE_ID FROM 
(SELECT USER_ID, MIN(TS) AS MINTS FROM SAMPLE GROUP BY USER_ID) AS F
LEFT JOIN SAMPLE AS S
ON F.USER_ID = S.USER_ID AND F.MINTS = S.TS) AS FIRST
ON LAST.USER_ID = FIRST.USER_ID) AS FINAL
WHERE SITE_ID1 = SITE_ID2;
